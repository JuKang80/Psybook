<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>PsyBook | ë¡œê·¸ì¸ ë° ê°œì¸ì •ë³´ ë™ì˜</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #ffffff;
    }
    .background-img {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
      opacity: 0.08;
      pointer-events: none;
    }
    .container {
      display: flex;
      flex-direction: row;
      width: 100%;
      min-height: 100vh;
    }
    .left, .right {
      flex: 1;
      padding: 40px;
      box-sizing: border-box;
    }
    .left {
      background-color: rgba(245, 245, 245, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      box-shadow: inset -10px 0 20px rgba(0,0,0,0.05);
    }
    .left .inner {
      margin: 0 auto;
      max-width: 400px;
    }
    .left h1 {
      margin-top: 0;
      font-size: 2.2em;
    }
    .left p {
      margin: 10px 0;
      line-height: 1.6;
    }
    .right {
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    form {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 300px;
    }
    input {
      margin-bottom: 15px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      outline: none;
    }
    button {
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <img class="background-img" src="https://raw.githubusercontent.com/JuKang80/Psybook/main/knu_psy_logo.jpg" alt="ë°°ê²½">

  <!-- â–¶â–¶ ë¡œê·¸ì¸(Setup) í™”ë©´ â—€â—€ -->
  <div class="container" id="setupView">
    <div class="left">
      <h1>ğŸ“š PsyBook</h1>
      <h3>ì‹¬ë¦¬í•™ê³¼ ë„ì„œëŒ€ì—¬ ì›¹ì„œë¹„ìŠ¤</h3>
      <p>
        <strong>ìš´ì˜ê¸°ê°„:</strong> í‰ì¼ê³¼ ì£¼ë§ 24ì‹œê°„<br>
        <strong>ëŒ€ìƒ:</strong> ì‚¬íšŒê³¼í•™ëŒ€í•™ 204í˜¸ ì‹¬ë¦¬í•™ê³¼ ê³¼ë°© ë‚´ ì „ê³µì±… ë„ì„œ
      </p>
      <p>
        ìˆ˜ì§‘ëœ ì •ë³´ëŠ” ëŒ€ì—¬ ê´€ë¦¬ ëª©ì  ì™¸ ë‹¤ë¥¸ ìš©ë„ë¡œ í™œìš©ë˜ì§€ ì•Šìœ¼ë©°, 
        <strong>ìˆ˜ì§‘ ì´ìš©ì˜ ëª©ì  ë‹¬ì„± ì‹œê¹Œì§€</strong> ë³´ê´€ë©ë‹ˆë‹¤.
      </p>
      <p style="color: red; font-weight: bold;">
        â— ì‚¬ì´íŠ¸ë¥¼ í†µí•˜ì§€ ì•Šê³  ë¬´ë‹¨ ì‚¬ìš©í•˜ê±°ë‚˜ í—ˆìœ„ë¡œ ì •ë³´ë¥¼ ì‘ì„±í•  ê²½ìš°, 
        ì¦‰ì‹œ ëŒ€ì—¬ê°€ ì·¨ì†Œë˜ë©° ì•ìœ¼ë¡œì˜ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
      <p>
        ğŸ‘‰ <strong>ëŒ€ì—¬ì‚¬ì—… ê´€ë¦¬:</strong> <a href="tel:01021728496">010-2172-8496</a>
      </p>
      <p>
        ë³¸ ì„œë¹„ìŠ¤ëŠ” <strong>ì´ë¦„, í•™ë²ˆ, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼</strong>ì„ ìˆ˜ì§‘í•˜ë©°, 
        ë„ì„œ ëŒ€ì—¬ ì´ë ¥ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
      </p>
      <label>
        <input type="checkbox" id="agreeCheckbox"> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
      </label>
    </div>

    <div class="right">
      <form id="userForm">
        <input type="text" id="name" placeholder="ì´ë¦„" required>
        <input type="text" id="studentId" placeholder="í•™ë²ˆ" required>
        <input type="tel" id="phone" placeholder="ì „í™”ë²ˆí˜¸" required>
        <input type="email" id="email" placeholder="ì´ë©”ì¼" required>
        <button type="submit" id="submitBtn" disabled>ì±… ë³´ëŸ¬ê°€ê¸°</button>
      </form>
    </div>
  </div>

  <!-- â–¶â–¶ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™”ë©´ (ì´ˆê¸°ì— ìˆ¨ê¹€) â—€â—€ -->
  <div id="libraryWrapper" style="display:none">
    <?!= include('library'); ?>
  </div>

<!-- â–½â–½ í´ë¼ì´ì–¸íŠ¸ ìŠ¤í¬ë¦½íŠ¸ â–½â–½ -->
<script>
(() => {
  const form       = document.getElementById('userForm');
  const checkbox   = document.getElementById('agreeCheckbox');
  const submitBtn  = document.getElementById('submitBtn');
  const nameInput  = document.getElementById('name');
  const idInput    = document.getElementById('studentId');
  const phoneInput = document.getElementById('phone');
  const mailInput  = document.getElementById('email');

  /* â”€â”€ ìœ í‹¸ â”€â”€ */
  const blank   = s => s.trim().length === 0;
  const emailOk = e => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
  const setBorder = (el, ok) => el.style.border = ok ? '1px solid #ccc' : '2px solid red';

  function validate() {
    const nv = !blank(nameInput.value);
    const iv = !blank(idInput.value);
    const pv = !blank(phoneInput.value);
    const ev = !blank(mailInput.value) && emailOk(mailInput.value);
    [ [nameInput,nv], [idInput,iv], [phoneInput,pv], [mailInput,ev] ].forEach(([el,ok]) => setBorder(el,ok));
    submitBtn.disabled = !(nv && iv && pv && ev && checkbox.checked);
  }

  validate();                                   // ì´ˆê¸° ìƒíƒœ ë°˜ì˜
  [ nameInput, idInput, phoneInput, mailInput ].forEach(el => el.addEventListener('input', validate));
  checkbox.addEventListener('change', validate);

  /* â”€â”€ ì œì¶œ â”€â”€ */
  form.addEventListener('submit', evt => {
    evt.preventDefault();
    submitBtn.disabled = true;
    submitBtn.textContent = 'ì €ì¥ ì¤‘â€¦';

    google.script.run
      .withSuccessHandler(rowIdx => {
        /* í™”ë©´ ì „í™˜ */
        document.getElementById('setupView').style.display   = 'none';
        document.getElementById('libraryWrapper').style.display = 'block';
        /* â–¶ï¸ ë°°ê²½ ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸° (ì¶”ê°€ëœ í•œ ì¤„) */
        const bg = document.querySelector('.background-img');
        if (bg) bg.style.display = 'none';

        /* ì„¸ì…˜ ì €ì¥ & ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ˆê¸°í™” */
        window._rowIdx = rowIdx;
        if (typeof initLibrary === 'function') initLibrary();
      })
      .withFailureHandler(err => {
        console.error(err);
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'ì±… ë³´ëŸ¬ê°€ê¸°';
      })
      .saveUserInfo(
        nameInput.value.trim(),
        idInput.value.trim(),
        phoneInput.value.trim(),
        mailInput.value.trim()
      );
  });
})();
</script>

</body>
</html>

